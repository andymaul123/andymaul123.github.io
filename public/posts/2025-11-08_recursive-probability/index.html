<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Andrew Maul</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="icon" type="image/x-icon" href="/image/favicon.ico" >
  <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Ovo" rel="stylesheet">
  <link rel="alternate" type="application/rss+xml" href="https://andrewmaul.com/feed.xml" title="Latest articles from the blog.">
</head>
<body>
  <div class="mobile-header">
    <img src="/image/logo.svg" alt="logo" />
    <div class="menu-button">
        <input class="menu-input" type="checkbox" id="menu-input" name="menu-input" />
        <label class="menu-icon" for="menu-input">
            <span class="icon-menu icon"></span>
        </label>
        <div class="mobile-menu-open">
            <a href="/" class="no-underline shadows ">home</a>
            <a href="/projects" class="no-underline shadows ">projects</a>
            <a href="/art" class="no-underline shadows ">art</a>
            <a href="/posts/2026-02-04_learning-soft-pastels" class="no-underline shadows active">blog</a>
            <a href="/resume" class="no-underline shadows ">résumé</a>
        </div>
    </div>
</div>

  <div class="container">
    <section>
      <div class="row">
        <div class="twelve columns">
          <nav class="desktop-nav">
    <a href="/" class="no-underline shadows ">home</a>
    <a href="/projects" class="no-underline shadows ">projects</a>
    <a href="/art" class="no-underline shadows ">art</a>
    <a href="/posts/2026-02-04_learning-soft-pastels" class="no-underline shadows active">blog</a>
    <a href="/resume" class="no-underline shadows ">résumé</a>
</nav>
        </div>
      </div>
        <div class="row">
            <div class="nine columns blog">
                
                <h1>Recursive Probability</h1>
                <div class="post-date right">November 2025</div>
                <div><div class="post-content-two-items">
    <div>
        <p>
            <span class="dropcap">T</span>his is a follow-up to my previous blog post, <a href="/posts/2025-06-28_elemental-probability">Elemental Probability</a>, which should be read prior to this one for context. Earlier this year I released v1.0 of the CLI tool. I wasn't entirely happy with the logic, but it "worked" and I wanted to move onto something else. I used the tool to run probabilities on a few of my sorcery decks, and was content with it all until...I ran into a bug.
        </p>

        <p>Like pulling a thread from a shirt, the more I pulled the more it all unraveled. There were serious flaws in the approach, the least of which was the spaghetti mess of loops it relied on. Back to the drawing board I went.</p>
    </div>
    <div>
        <a href="/image/posts/2025-11-08_recursive-probability/colour.png" class="post-image  full">
    <img src="/image/posts/2025-11-08_recursive-probability/colour.png" class="post-image-picture outline"/>
    <span class="post-image-caption"></span>
</a>

    </div>
</div>

<h2>Breakdown</h2>

<p>One of my goals for 2.0 was to replace the 'combinations-generator' portion of the app with something more elegant. The tool is divided into three main parts: the combinations generator, the math to derive probability, and a simulation to corroborate results. I hoped that by re-writing the combinations generator from the ground up that I could fix the bugs at the same time. The simulation and math portions of the tooling just needed a few minor tweaks; turns out math doesn't need to change all that much once you've figured it out.</p>

<h3>Simulation</h3>

<p>The easiest part of this app was writing (and subsequently re-writing) the simulation. Midway through the first version I made a <strong>critical</strong> mistake in coupling the simulation with the combinations generator. In order to function as a check, the simulation portion needs to be completely independent from the combinations generator. So what does the simulation actually do?</p>

<p>Given a number of iterations, the tool sets up the card deck as an array and randomly generates N numbers (for simplicity here, three). The three random numbers select three indices from the card array. The symbols on those three cards are aggregated, and then checked against the resulting criteria. If it's a success, a counter is incremented. The successes are divided by the total runs and that's it, a probability is generated.</p>

<h3>The Math</h3>
<p>A multivariate hypergeometric distribution is the very fancy name given to the type of math used in determining probability here. It sets up a giant equation that boils down to the following question: for every unique combination of cards drawn that satisfy the criteria, what is the probability of drawing that combination? </p>

<div>
    <a href="/image/posts/2025-11-08_recursive-probability/wikipedia.png" class="post-image  full">
    <img src="/image/posts/2025-11-08_recursive-probability/wikipedia.png" class="post-image-picture outline"/>
    <span class="post-image-caption">Example from wikipedia: binomial distribution without replacement</span>
</a>

</div>

<p>That single probability is cumulatively added along with <em>every other unique combination</em> to arrive at the final probability. Finding all of those combinations is the hard part.</p>

<h3>Generating Combinations</h3>
<p>This is where the bugs came from, and the mess I wanted to clean up. On my second attempt I knew I wanted to write a recursive function that would perform a brute-force "walk" of the card array, testing each combination as it went. This was made more difficult by a dynamic number of cards to be drawn. I settled on using a 'pointer' array to track which combination of cards was being looked at. The recursive function calls itself over and over, passing in the accumulated data from the previous run until it meets the exit condition.</p>

<p>What I didn't know going into this was that a recursive approach was going to quickly reach Node's built in stack limit, a problem that doesn't occur through looped iteration. Thus I hit a developer milestone: the stack overflow. I was very excited - I was a real dev, now! The solution was less exciting, and required building in a setTimout function that allowed Node to clear its stack, and requiring me to update the tool into asynchronous code.</p>

<h2>Au revoir, mon ami</h2>
<p>Version 2.0 is up on my <a href="https://github.com/andymaul123/sorcery-threshold" target="_blank">Github</a>. Not only did I fix the bugs and implement cleaner logic, I added a robust test suite along the way. Due to the complexity of this project I had to rely on abstracting as much logic into testable parts as I could. The simulation, now properly decoupled from the generations combinator, provides a much tighter band of probability than previously.</p>

<p>All in all I am very pleased with 2.0, and equally ready to not look at it again.</p></div>
            </div>
            
            <div class="three columns archives">
                <h2>Archives</h2>
                <ul>
    <li><a href="/posts/2026-02-04_learning-soft-pastels">Learning Soft Pastels</a><br /><em>Feb 2026</em></li>
    <li><a href="/posts/2025-11-08_recursive-probability">Recursive Probability</a><br /><em>Nov 2025</em></li>
    <li><a href="/posts/2025-06-28_elemental-probability">Elemental Probability</a><br /><em>Jun 2025</em></li>
    <li><a href="/posts/2025-02-17_dev-log_retro-asset-pipeline">Dev Log: Retro Asset Pipeline</a><br /><em>Feb
            2025</em></li>
    <li><a href="/posts/2024-08-11_website-relaunch">Website Re-launch!</a><br /><em>Aug 2024</em></li>
    <li><a href="/posts/2024-08-07_dunes-and-dusk">Dunes &amp; Dusk</a><br /><em>Aug 2024</em></li>
    <li><a href="/posts/2023-10-31_fakemon-inktober">Pixel Art: Fakemon</a><br /><em>Oct 2023</em></li>
    <li><a href="/posts/2023-07-01_art-jam-experiments-with-pixelization">Art Jam: Experiments with
            Pixelization</a><br /><em>Jul 2023</em></li>
    <li><a href="/posts/2022-06-19_studying-the-masters">Studying the Masters</a><br /><em>Jun 2022</em></li>
    <li><a href="/posts/2019-06-26_adventure-js">Adventure.js</a><br /><em>Jun 2019</em></li>
    <li><a href="/posts/2019-02-27_banner-generator">EDH Banner Generator</a><br /><em>Feb 2019</em></li>
</ul>
            </div>
        </div>
    </section>
  </div>
  
<footer class="new-footer">
  <div class="foot-left">
    <div> <span class="icon-envelope icon"></span> <span class="email-address">andymaul123@gmail.com</span></div>
  </div>
  <div class="foot-center">
    &copy; Andrew Maul 2026. Made with <a href="https://github.com/dhg/Skeleton" target="new" class="no-underline">Skeleton</a>, <a href="https://github.com/doug2k1/nanogen/" class="no-underline" target="new">Nanogen</a>, <a href="https://prismjs.com/" class="no-underline" target="new">Prism.js</a>, and <a href="https://icomoon.io/" class="no-underline" target="new">IcoMoon</a>.
  </div>
  <div class="foot-right">
    <a href="https://github.com/andymaul123" target="new" class="no-underline footer-link"><span class="icon-github icon"></span></a>
    <a href="https://www.linkedin.com/in/andymaul" target="new" class="no-underline footer-link"><span class="icon-linkedin2 icon"></span></a>
    <a href="/feed.xml" target="new" class="no-underline footer-link" id="rss-button"><span class="icon-rss2 icon"></span></a>
  </div>
</footer>


  <!-- Prism.js syntax highlighting -->
<script type="text/javascript" src="/js/prism.js"></script>
  <script type="text/javascript">
    const rssButton = document.getElementById('rss-button');
    rssButton.addEventListener("click", (e) => {
        e.preventDefault();
        writeClipboardText("https://andrewmaul.com/feed.xml")
    });

    async function writeClipboardText(text) {
        try {
            await navigator.clipboard.writeText(text);
            alert('RSS url copied to clipboard!');
        } catch (error) {
            console.error(error.message);
        }
    }
</script>

</body>
</html>